import xbmc,xbmcaddon,xbmcgui,xbmcplugin,urllib,urllib2,os,re,sys,datetime,hashlib,urlresolver,liveresolver,timeimport base64import HTMLParserimport osfrom resources.libs.modules import satoolsaddon_id        = 'plugin.video.streamarmy'AddonTitle      = "[COLOR red][B]STREAM ARMY[/B][/COLOR]"fanart          = xbmc.translatePath(os.path.join('special://home/addons/' + addon_id , 'fanart.jpg'))fanarts         = xbmc.translatePath(os.path.join('special://home/addons/' + addon_id , 'fanart.jpg'))icon            = xbmc.translatePath(os.path.join('special://home/addons/' + addon_id, 'icon.png'))dialog          = xbmcgui.Dialog()dp              = xbmcgui.DialogProgress()def SCRAPE_123MOVIES(url):    link = satools.open_url(url)    match = re.compile('<div id="movie-featured"(.+?)</span>').findall(link)    for links in match:        url = re.compile('<a href="(.+?)"').findall(links)[0]        icon = re.compile('<img src="(.+?)"').findall(links)[0]        fanart = re.compile('<img src="(.+?)"').findall(links)[0]        title = re.compile('<i>(.+?)</i>').findall(links)[0]        title = title.strip()        satools.addDir("[COLOR silver]" + title + "[/COLOR]",url,30,icon,fanart,'')    try:        np = re.compile('<a class=\"pagecurrent\".+?pagelink\"\s.+?href=([^ ]+)').findall(link)[0]        icon = 'http://i.imgur.com/B4r7zDm.png'        fanart = 'http://i.imgur.com/rqPqVFx.png'        satools.addDir('[COLOR red]Next Page >>[/COLOR]',np,29,icon,fanart)           except: pass        def SCRAPE_123MOVIES_LINKS(url):    link = satools.open_url(url)    icon = re.compile ('<div class="thumb mvic-thumb".+?url(.+?);">').findall(link)[0].replace('(', '').replace(')', '')    match = re.compile('<p class="server_servername">(.+?)</a>').findall(link)    for links in match:        url = re.compile ('<a href="(.+?)"').findall(links)[0]        title = re.compile ('(.+?)</p>').findall(links)[0].replace('Server', '')        title = title.strip()        satools.addLink("[COLOR silver]" + title + "[/COLOR]",url,31,icon,fanart,'')                def SCRAPE_123MOVIES_PLAY(name,url,iconimage):    link = satools.open_url(url)    grab = re.compile ('Base64.decode.+?"(.+?)"').findall(link)[0]    decrypt = base64.b64decode (grab)    url = re.compile ('src="(.+?)"').findall(decrypt)[0]    import urlresolver    try:        if urlresolver.HostedMediaFile(url).valid_url():             stream_url = urlresolver.HostedMediaFile(url).resolve()        elif liveresolver.isValid(url)==True:             stream_url=liveresolver.resolve(url)        else: stream_url=url        liz = xbmcgui.ListItem(name,iconImage='DefaultVideo.png', thumbnailImage=iconimage)        liz.setPath(stream_url)        xbmcplugin.setResolvedUrl(int(sys.argv[1]), True, liz)        dp.create(AddonTitle,"[COLOR yellow]Generating link...[/COLOR]",'[COLOR red]Please wait...[/COLOR]','')           dp.update(0)        time.sleep(2)        xbmc.Player ().play(stream_url, liz, False)    except:        dialog.ok(AddonTitle, "[COLOR yellow]Sorry, It seems the file has been removed at source,\nPlease try another link!\n[COLOR white]Stream Army Team[/COLOR]")        quit()        def SCRAPE_123MOVIES_SEARCH(url):    issearch = 0    try:        url,term = url.split("|SPLIT|")        issearch = 1    except: pass        namelist     = []    urllist      = []    iconlist     = []    fanartlist   = []    combinedlist = []        url_check = url    link = satools.open_url(url)    match = re.compile('<div id="movie-featured"(.+?)</span>').findall(link)    for links in match:        url = re.compile('<a href="(.+?)"').findall(links)[0]        icon = re.compile('<img src="(.+?)"').findall(links)[0]        fanart = re.compile('<img src="(.+?)"').findall(links)[0]        title = re.compile('<i>(.+?)</i>').findall(links)[0]        title = title.strip()        namelist.append(title)        urllist.append(url)        iconlist.append(icon)        combinedlist = list(zip(namelist,urllist,iconlist))    for title,url,icon in combinedlist:            if issearch == 0:             satools.addDir("[COLOR silver]" + title + "[/COLOR]",url,30,icon,fanart,'')        else:            if ' ' in term:                notfound = 0                checks = term.split(" ")                for check in checks:                    if not check.lower() in title.lower():                        notfound = 1                if notfound == 0:                     satools.addDir("[COLOR silver]" + title + "[/COLOR]",url,30,icon,fanart,'')            else:                if term.lower() in title.lower():                     satools.addDir("[COLOR silver]" + title + "[/COLOR]",url,30,icon,fanart,'')