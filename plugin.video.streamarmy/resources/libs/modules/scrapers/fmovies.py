import xbmc,xbmcaddon,xbmcgui,xbmcplugin,urllib,urllib2,os,re,sys,datetime,hashlib,timeimport base64import HTMLParserimport osfrom resources.libs.modules import satoolsaddon_id        = 'plugin.video.streamarmy'AddonTitle      = "[COLOR red][B]STREAM ARMY[/B][/COLOR]"fanart          = xbmc.translatePath(os.path.join('special://home/addons/' + addon_id , 'fanart.jpg'))fanarts         = xbmc.translatePath(os.path.join('special://home/addons/' + addon_id , 'fanart.jpg'))icon            = xbmc.translatePath(os.path.join('special://home/addons/' + addon_id, 'icon.png'))dialog          = xbmcgui.Dialog()dp              = xbmcgui.DialogProgress()def SCRAPE_FMOVIES_CATS(url):    link = satools.open_url(url)    match = re.compile('<ul class="sub-menu w1">(.+?)</ul>').findall(link)[0]    grab = re.compile ('<a href="(.+?)".+?>(.+?)</a>').findall(match)    for url1,title in grab:        url = 'http://fmovie.io' + url1 + '?page=1'        if not 'TV Show' in title:            satools.addDir("[COLOR silver]" + title + "[/COLOR]",url,38,icon,fanarts,'')            def SCRAPE_FMOVIES_YEARS(url):    link = satools.open_url(url)    match = re.compile('<ul class="sub-menu w3">(.+?)</ul>').findall(link)[0]    grab = re.compile ('<a href="(.+?)".+?>(.+?)</a>').findall(match)    for url1,title in grab:        url = 'http://fmovie.io' + url1        satools.addDir("[COLOR silver]" + title + "[/COLOR]",url,38,icon,fanarts,'')            def SCRAPE_FMOVIES_CONTENT(url):    link = satools.open_url(url)    match = re.compile('<figure>(.+?)</figure>').findall(link)    for links in match:        try:            title = re.compile ('title="(.+?)"').findall(links)[0]            title = satools.CLEANUP(title)            url1 = re.compile ('<a href="(.+?)"').findall(links)[0]            url2 = 'http://fmovie.io/' + url1            icon1 = re.compile ('src="(.+?)"').findall(links)[0]            icon = 'http:' + icon1            quality = re.compile ('<div class="quanlity">(.+?)</div>').findall(links)[0]            length = re.compile ('<div class="time">.+?</i>(.+?)</div>').findall(links)[0].strip()            satools.addDir("[COLOR silver]" + title + " ::" "[COLOR yellow] " + quality + " ::" + "[COLOR red] " + length +  "[/COLOR]",url2,39,icon,fanarts,'')        except:pass            try:        match = re.compile('<li  class=selected>(.+?)</ul>').findall(link)[0]        np = re.compile ('<a href=\'(.+?)\'').findall(match)[1]        sep = '?'        url = url.split(sep, 1)[0]        nextpage = url + np        icon = 'http://i.imgur.com/B4r7zDm.png'        satools.addDir("[COLOR red]" + "Next Page" + "[/COLOR]",nextpage,38,icon,fanarts,'')    except:pass            def SCRAPE_FMOVIES_LINKS(name,url,iconimage):    link = satools.open_url(url)    match = re.compile('</footer>(.+?)</body>').findall(link)[0]    grab = re.compile ('var link_server(.+?);').findall(match)    for links in grab:        title = re.compile ('_(.+?)=').findall(links)[0]        title = title.title()        try:            url1 = re.compile ('"(.+?)"').findall(links)[0]        except IndexError:            url1 = re.compile ('\'(.+?)\'').findall(links)[0]        if not 'https:' in url1:            url = 'http:' + url1        if 'Yourupload' in title:            dp.create(AddonTitle,"[COLOR yellow]Generating link...[/COLOR]",'[COLOR red]Please wait...[/COLOR]','')               dp.update(0)            time.sleep(1)                import urlresolver            dp.update(50)                        if urlresolver.HostedMediaFile(url).valid_url():                 stream_url = urlresolver.HostedMediaFile(url).resolve()                dp.update(75)                liz = xbmcgui.ListItem(name,iconImage=icon, thumbnailImage=icon)                liz.setPath(stream_url)                dp.update(100)                dp.close()                xbmc.Player ().play(stream_url, liz, False)                quit()            else:                stream_url=url                dp.update(75)                liz = xbmcgui.ListItem(name,iconImage=icon, thumbnailImage=icon)                liz.setPath(stream_url)                dp.update(100)                dp.close()                xbmc.Player ().play(stream_url, liz, False)                quit()        